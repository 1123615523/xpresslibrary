var onlinePreview={scrolling:'yes',isFirst:true,int:function(width,height,title){var marginLeft=width/2;var innerHtml='';innerHtml+='<div id="mask" style="width:100%; height:100%; position:fixed; top:0; left:0; z-inde:1999;background:#cccccc; filter:alpha(opacity=50); -moz-opacity:0.5; -khtml-opacity: 0.5; opacity:0.5;"></div>'
innerHtml+='<div id="maskTop" style="width: '+width+'px; height: '+height+'px; border: #999999 1px solid; background: #fff; color: #333; position: fixed; top: 0; left: 50%; margin-left: -'+marginLeft+'px; margin-top: -'+0+'px; z-index: 2999; filter: progid:DXImageTransform.Microsoft.Shadow(color=#909090,direction=120,strength=4); -moz-box-shadow: 2px 2px 10px #909090; -webkit-box-shadow: 2px 2px 10px #909090; box-shadow: 2px 2px 10px #909090;">'
innerHtml+='<div id="maskTitle" style="height: 30px; line-height: 30px; font-family: 微软雅黑; font-size: 14px; color: #333333; padding-left: 20px; background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAyCAYAAABlG0p9AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAABvSURBVEhL1cq5DcAwDENR7T+sL9lOOoUbkCoCwwKewOJbiGe+31BkwgeDM18YgrPhxuBs4CkS4cQQZMKFwd0R+gzFJaFjcD+EfXgoMuHA4O4Iew/FJWHD4BJhwxDoYcNTIKwY3NGwYggQFgxODEt8xO1/6P+HHxEAAAAASUVORK5CYII=); border-bottom: 1px solid #999999; position: relative;">'
innerHtml+='<div style="width: 95%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">'+title+'</div>'
innerHtml+='<div id="popWinClose" style="width: 28px; height: 28px; cursor: pointer; position: absolute; top: 0px; right: 1px; background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABzElEQVRYR+1VO0vDYBQ996uimzENta1iNwUXEUVH3XTyMdjqL7To4GPSTUcFQQUF3ZRq2prEuFWk35WvNBCDtgm1FCFZAuHknMN9nEvo8UM91kdsIK5AXIFQFcgaw9tS0nXZce7CrG3GGJoF07hpu/vt8G0NpHV9ShDfKiJiyj87zl4r0lFd32Ti3QZe8Mzzq3vVCt/WQCqVGumrf5Y9klYm/OIK30+J7KNlmR0ZUD9nk9o6QDsABn+rREC8BvDWi+0edtwCjyCj6ysgLhIwFDThF2fgHUwF03FO2ok3eMKAPEza0JYEowjQiGdCvb2eA1yRhELZcs/C8kYyoEjHkskFCamGbDwg8igg8iXbvggrHrkCHvGopk1zArsATTS/3QuJfOnt7SaK+P808L0F/KDSAcAkgO63IDCET1TnVSJiKXAEINfVIfy+hlwRSKyVbPu8OZjzEvUjtR1dWUN/ECkBJl4vW+6pf+DShrZITIfNnPi7IApEcY2ZNkzHOf5p2jO6vkzEB15i/kkU+48RwBsvtqsEfn2ySW0NoAaGSc6Z1vtlx7dAnde6GChVq9VKmD3PGUbmQ8rhMOc7chKGMRAFExuIKxBXoOcV+ALiTdchQe6rBQAAAABJRU5ErkJggg==);"></div>'
innerHtml+='</div>'
innerHtml+='<div id="preview_container" style="-webkit-overflow-scrolling:touch;overflow:auto;overflow-x: hidden;width: '+width+'px;height: '+height+'px;">'
innerHtml+='<div class="container" id="imgsArea"></div>'
innerHtml+='<div id="waitContainer" style="background-color: grey;height: '+height+'px; display: flex;align-items: center;justify-content: center;"><div  style="margin-left: 10px; margin-right: 10px;border-radius:5px; width:400px;height: 120px; background-color: white; display: flex;align-items: center;justify-content: center"><img src="https://static.wenku365.com/images/loading_d1.gif"><div style="margin-left: 20px;"><div>加载中（预计需要20秒）</div><div>部分较大文档加载慢，如长时间无法显示请刷新本页面</div></div></div></div>';innerHtml+='<div style="height: 50px"></div>'
innerHtml+='</div>'
innerHtml+='</div>'
$("body").append(innerHtml);this.closeMouse();this.closeMask();this.closeContextMenu();},showWin:function(width,height,title,domain,param,bookPage){if(this.isFirst){this.int(width,height,title);bindEvent();initData(width,domain,param,bookPage);this.isFirst=false}else{$("#mask,#maskTop").show();showAdContent();}},closeContextMenu:function(){$("#imgsArea").bind("contextmenu",function(e){return false;});},closeMouse:function(){$("#popWinClose").on('mouseenter',function(){$(this).css("background-image","url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAB1ElEQVRYR+1VTS8DURQ999GpsBArQTs+EtqKRISwZMfKx0LxC0ktfKzYsSSRIKEfErSdhC4tCDPtu/KqkjFRM9VKI5m3eYt33z0n5957LqHJh5qMD5+Ar4CvgCcFMmFtgwgXwznz2svYJvXApCDSI1lzxy3elcCNro2WgKtKong0Z27/lDSla6sAEiqmKHhi7N46/ynelcDtYEe3WbIebUmqkrCDq/g2au0dyL481EVAfU6HtWUQNhloq6aEA/wVjPVo3tyruwSfCVKh4AIEbwHodJJwgD8x01os/3boBq7eXUtgT5IMtc4JQVsM6v4kUbnLNWdwAZLXYkbx2At4zQTUh0woMFMiShBBd4BkSXI8YlinXsF/RaDcE32BcRaUAGGkApaGRDxqmJe1gP9PAl9KwMiAwAAiAP6+BPYmZEZOSF5kIobAPoD+P21C+xgSuEASSyOGdVLuiVBgWgrs08d0NH4MHUb0xFIux4zikWNEZ0kIZTzKJxpnRHYrJuCVJa1EjbeD77o9GQ7OE/GucuGGWbF9GRFjJZI3FUDVkwprSyCUYxg8FctZZ3XvArVegy2aMXT3XPAy5/f97T0WF7u8rO+arNgLeK0xPgFfAV+BpivwDmq60CEgmwJAAAAAAElFTkSuQmCC)");});$("#popWinClose").on('mouseleave',function(){$(this).css("background-image","url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABzElEQVRYR+1VO0vDYBQ996uimzENta1iNwUXEUVH3XTyMdjqL7To4GPSTUcFQQUF3ZRq2prEuFWk35WvNBCDtgm1FCFZAuHknMN9nEvo8UM91kdsIK5AXIFQFcgaw9tS0nXZce7CrG3GGJoF07hpu/vt8G0NpHV9ShDfKiJiyj87zl4r0lFd32Ti3QZe8Mzzq3vVCt/WQCqVGumrf5Y9klYm/OIK30+J7KNlmR0ZUD9nk9o6QDsABn+rREC8BvDWi+0edtwCjyCj6ysgLhIwFDThF2fgHUwF03FO2ok3eMKAPEza0JYEowjQiGdCvb2eA1yRhELZcs/C8kYyoEjHkskFCamGbDwg8igg8iXbvggrHrkCHvGopk1zArsATTS/3QuJfOnt7SaK+P808L0F/KDSAcAkgO63IDCET1TnVSJiKXAEINfVIfy+hlwRSKyVbPu8OZjzEvUjtR1dWUN/ECkBJl4vW+6pf+DShrZITIfNnPi7IApEcY2ZNkzHOf5p2jO6vkzEB15i/kkU+48RwBsvtqsEfn2ySW0NoAaGSc6Z1vtlx7dAnde6GChVq9VKmD3PGUbmQ8rhMOc7chKGMRAFExuIKxBXoOcV+ALiTdchQe6rBQAAAABJRU5ErkJggg==)");});},closeMask:function(){$("#popWinClose").on('click',function(){$("#mask,#maskTop").fadeOut(function(){stopBodyScroll(false);document.body.removeEventListener('touchmove',bodyScroll,{passive:false});$("body").css({"position":"initial","height":"auto"});$("#maskTop").hide();});});}};function bodyScroll(event){event.preventDefault();}
var top1=0
function stopBodyScroll(isFixed){var bodyEl=document.body
if(isFixed){top1=window.scrollY
bodyEl.style.position='fixed'
bodyEl.style.top=-top1+'px'}else{bodyEl.style.position=''
bodyEl.style.top=''
window.scrollTo(0,top1)}}
var isOk=false;var beginId=1;function initData(width,domain,params,bookPage){var onlineService=domain;if(!onlineService){onlineService="https://view.wenku365.com";}
if(onlineService.charAt(onlineService.length-1)==="/"){onlineService=onlineService.slice(0,onlineService.length-1);}
var imgWidth=width-5;$.ajax({type:"GET",url:domain+"isCache2",dataType:"json",data:{params:params},success:function(data){if(data.page!==-1){for(var i=beginId;i<=data.page;i++){if(document.getElementById("img-area-"+i)){continue}
if(i===1){$("#imgsArea").append("<div style='max-width: "+width+"px;display: flex;'  class='ad-area' id=addiv"+0+"></div>");$("#imgsArea").append('<div id="img-area-'+i+'" class="img-area" style="max-width: '+width+'px; min-height: 400px;height:100%;display: flex;align-items: center;flex-wrap: nowrap;justify-content: center;"><img class="my-photo" draggable="false" alt="loading"  style="pointer-events: none; cursor: pointer;max-width: '+imgWidth+'px" data-src="'+onlineService+data.urlPrefix+i+'.gif" src="'+onlineService+data.urlPrefix+i+'.gif"></div>');}
else{$("#imgsArea").append('<div id="img-area-'+i+'" class="img-area" style="max-width: '+width+'px; min-height: 400px;height:100%;display: flex;align-items: center;justify-content: center;"><img class="my-photo" alt="loading" draggable="false"  style="pointer-events: none; cursor: pointer;max-width: '+imgWidth+'px" data-src="'+onlineService+data.urlPrefix+i+'.gif" src="https://static.wenku365.com/view/images/loading2.gif"></div>');}
$("#imgsArea").append('<div style="max-width: '+width+'px;height: 15px;font-size: 14px"><span style="font-size: 14px;float: right;margin-right: 20px"><span style="color: red">'+i+'</span>&nbsp;/&nbsp;'+bookPage+'  </span></div>');$("#imgsArea").append('<div style="max-width: '+width+'px;margin-top:6px;height: 15px;background-color: #696969"></div>');$("#imgsArea").append("<div style='max-width: "+width+"px;display: flex;'  class='ad-area' id=addiv"+i+"></div>");}
var element=document.getElementById("imgsArea");element.addEventListener("touchmove",throttle(checkImgs));beginId=data.page;if(data.page>=data.totalPage){isOk=true;}
else{window.setInterval(function(){showalert(width,domain,params,bookPage)},3000);}
$("#container").show();$("#waitContainer").hide();showAdContent();}else{window.setInterval(function(){showalert(width,domain,params,bookPage)},3000);$("#container").hide();$("#waitContainer").show();}},error:function(msg){}})}
function showalert(width,domain,params,bookPage){var onlineService=domain;if(!onlineService){onlineService="https://view.wenku365.com";}
if(onlineService.charAt(onlineService.length-1)==="/"){onlineService=onlineService.slice(0,onlineService.length-1);}
var imgWidth=width-5;if(isOk===false){$.ajax({type:"GET",url:domain+"isCache2",dataType:"json",data:{params:params},success:function(data){if(data.page!==-1){for(i=beginId;i<=data.page;i++){if(document.getElementById("img-area-"+i)){continue}
if(i===1){$("#imgsArea").append("<div style='max-width: "+width+"px;display: flex;'  class='ad-area' id=addiv"+0+"></div>");$("#imgsArea").append('<div id="img-area-'+i+'" class="img-area" style="max-width:'+width+'px; min-height: 400px;display: flex;align-items: center;justify-content: center"><img class="my-photo" draggable="false" alt="loading"  style="pointer-events: none; cursor: pointer;max-width: '+imgWidth+'px" data-src="'+onlineService+data.urlPrefix+i+'.gif" src="'+onlineService+data.urlPrefix+i+'.gif"></div>');}
else{$("#imgsArea").append('<div id="img-area-'+i+'" class="img-area" style="max-width: '+width+'px; min-height: 400px;display: flex;align-items: center;justify-content: center"><img class="my-photo" draggable="false" alt="loading"  style="pointer-events: none; cursor: pointer;max-width: '+imgWidth+'px" data-src="'+onlineService+data.urlPrefix+i+'.gif" src="https://static.wenku365.com/view/images/loading2.gif"></div>');}
$("#imgsArea").append('<div style="max-width: '+width+'px;height: 15px;font-size: 14px"><span style="font-size: 14px;float: right; margin-right: 20px"><span style="color: red">'+i+'</span>&nbsp;/&nbsp;'+bookPage+'  </span></div>');$("#imgsArea").append('<div style="max-width: '+width+'px;margin-top:6px;height: 15px;background-color: #696969"></div>');$("#imgsArea").append("<div style='max-width: "+width+"px;display: flex;'  class='ad-area' id=addiv"+i+"></div>");}
var element=document.getElementById("imgsArea");element.addEventListener("touchmove",throttle(checkImgs));beginId=data.page;if(data.page>=data.totalPage)
isOk=true;$("#container").show();$("#waitContainer").hide();showAdContent();}},error:function(msg){}})}}
function bindEvent(){$("#preview_container").on("onload",checkImgs)
$("#preview_container").on("scroll",throttle(checkImgs))
bindTipEvent();}
function isInSight(el){var bound=el.getBoundingClientRect();var clientHeight=window.innerHeight;return bound.top<=clientHeight+100;}
var index=0;function checkImgs(){var imgs=document.querySelectorAll('.my-photo');for(var i=index;i<imgs.length;i++){if(isInSight(imgs[i])){loadImg(imgs[i]);index=i;}}}
function loadImg(el){var source=el.getAttribute("data-src");el.src=source;}
function throttle(fn){var timer=null;var previous=null;return function(){var now=new Date();var context=this;var args=arguments;if(!previous){previous=now;}
var remaining=now-previous;setTimeout(refresh(fn,remaining,context,args,previous,now));}}
function refresh(fn,remaining,context,args,previous,now){if(remaining>=500){fn.apply(context,args);previous=now;}}
function closeShowTip(){$("#tip-div").hide();}
function goDownload(url){$("#tip-div").hide();window.open(url)}
initAdContent();var adTimer;function initAdContent(){adTimer=setTimeout(function(){if(isOk){showAdContent();}else{window.clearInterval(adTimer)
initAdContent();}},400)}
function showAdContent(){$(".ad-area").html("")
var adHtml=document.getElementById("adPreDiv").outerHTML;$(".ad-area").append(adHtml);}
var lastIndex=0;function bindTipEvent(){$("#preview_container").on("scroll",function(e){var _this=this
var isPullDown=$(_this).scrollTop()>lastIndex
if(isOk&&isEnd(_this,$(_this).scrollTop())&&isPullDown){$("#tip-div").show();}
lastIndex=$(_this).scrollTop()})}
function isEnd(_this,scrollIndex){var h=$(_this).height();var st=$(_this)[0].scrollTop;var sh=$(_this)[0].scrollHeight;return h+st+50>=sh;}